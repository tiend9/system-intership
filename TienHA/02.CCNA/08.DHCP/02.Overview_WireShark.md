# WIRE SHARK

## I. WIRESHARK LÀ GÌ ?

### 1. Khái Niệm

- WireShark là ứng dụng ví như **Packet Analyzer**  
->  Là công cụ **Bắt(Capture)** , giải mã và phân tích gói mạng (không phải tool hack, tool sniff mật khẩu)

### 2. Nó nằm ở vị trí nào trong mạng ?

- **WireShark** không nằm trong luồng giao tiếp.
- Nó chỉ **đứng bên lề và nhìn** card mạng ở **Promiscuous Mode** và nhận mọi frame đi qua **Interface**.

![DHCP](./images/DHCP_7.png)

### 3. WhiteShark có công dụng gì ?

- Debug:

  - Web chậm
  - DB time out
  - API fail

- Solve Incident:

  - DDoS
  - Port Scan
  - Strange traffic

- Build Structure:

  - Xem LB có chia traffic không
  - Replica DB có nhận Query

### 4. WhiteShark làm được gì ?

- ***WhiteShark làm được**:

  - Cung cấp giao diện GUI cho OS
  - Bắt Packet layer `2` → `7`
  - **Decode** hàng trăm Protocol
  - Theo dõi flow TCP
  - Phân tích lỗi mạng
  - Debug `DHCP`, `DNS`, `TCP`, `TLS`

- **WhiteShark không làm được**:

  - Không giải mã HTTPS nếu không có key.
  - Không bắt được traffic nơi nó không nghe được
  - Không thay đổi Packet

![DHCP](./images/DHCP_8.png)

## II. HOW TO USE WIRE SHARK?

### 1. Tải & Cài đặt phần mềm và ứng dụng

`Bước 1`: Truy cập trang web chính thức của WireShark tại địa chỉ [này](https://www.wireshark.org/)

![DHCP](./images/DHCP_9.png)

`Bước 2`: Trong mục `Downloads`, chọn phiên bản phù hợp với hệ điều hành máy tính của bạn (32bits or 64 bits). Nhấp vào liên kết để tải về gối cài đặt `.exe` của WireShark.

![DHCP](./images/DHCP_10.png)

`Bước 3`: Sau khi download hoàn thành, bạn khởi chạy file install và tiếp tục làm theo hướng dẫn trên để hoàn thành cài đặt.

### 2. Cách sử dụng WireShark

Kích đúp vào 1 giao diện nào đó để xem chi tiết lưu lượng các gói tin trên giao diện đó.

- **Ví dụ**: ta xem lưu lượng trên giao diện `Wifi`:

  - Biểu tượng số `2` để ta bắt gói tin trên các giao diện ta đã chọn

![DHCP](./images/DHCP_11.png)

- Sau đó, lưu lượng gói tin qua giao diện `Wifi` sec được hiển thị lên như sau:

![DHCP](./images/DHCP_12.png)

=> Ta thấy giao diện WireShark được chia làm **3 phần chính** :

- **Packet list**: Hiển thị các gói tin bắt được trên 1 card mạng, Ở phần này mỗi gói tin là 1 dòng. Các gói tin được đánh số theo thứ tự

![DHCP](./images/DHCP_13.png)

- **Packet details**: Hiển thị thông tin chi tiết của 1 gói tin được chọn:

![DHCP](./images/DHCP_14.png)

- **Packet bytes**: Hiện thị dữ liệu thô của gói tin dưới dạng hex hoặc ASCII, giúp xem chi tiết nội dung thực tế, tìm kiếm thông tin nhạy cảm như (mật khẩu) trong các giao thức không mã hóa như (HTTP)

  - **Ví dụ** trong 1 gói tin HTTP response:  
  -> Ta có thể thấy thông tin về status trả về: `200`, các header, và dữ liệu trả về `Hello`

![DHCP](./images/DHCP_15.png)

- Ngoài ra, ta còn có thể lưu lại lưu lượng hiện tại bằng cách nhập nút đỏ trên thanh công cụ:

![DHCP](./images/DHCP_16.png)

- Sau đó để lưu, Ta chọn vào `file` -> `save`. Lưu lượng những gói tin này sẽ lưu dưới dạng file `.pcap`:

![DHCP](./images/DHCP_17.png)

- Thử mở lại file `tien9a.pcap` ta vừa lưu:

![DHCP](./images/DHCP_18.png)

### 3. Ý nghĩa màu sắc các gói tin trong WireShark

![DHCP](./images/DHCP_19.png)

- Để xem ý nghĩa màu sắc các gói tin trong WireShark ta làm như sau: Chọn `View` -> `Colouring Rules`

![DHCP](./images/DHCP_20.png)

![DHCP](./images/DHCP_21.png)

**Trong đó**:

- **`TCP RST` / `SCTP ABORT` - Nền đỏ chữ vàng**

![DHCP](./images/DHCP_22.png)

- **`Bad TCP` - Nền đỏ chữ cam**

  - `tcp.analysis.flags`: cờ này được bật khi gói TCP thuộc nhóm bất thường

  - `!tcp.analysis.window_update`: không phải là window update

  - `!tcp.analysis.keep_alive`: Không phải là tcp keep alive

  - `!tcp.analysis.keep_alive_ack`: không phải là các gói trả lời cho tcp keep alive

| Tên nhóm bất thường | Ý nghĩa                                                         |
|---------------------|-----------------------------------------------------------------|
| Retransmission      | Gửi lại một segment TCP do không nhận được ACK hoặc bị timeout  |
| Out of order        | Segment TCP đến không đúng thứ tự so với sequence number        |
| Zero Window         | Server hết buffer nhận, yêu cầu bên gửi tạm dừng truyền dữ liệu |

-> **Tóm lại**: Chỉ tô màu những gói tin TCP mà WireShark đánh giá là có vấn đề nhưng `KHÔNG` tô: `Window update`, `keep-alive`, `ACK` của keep alive

![DHCP](./images/DHCP_23.png)

- **`ICMP errors` - Nền đen, chữ xanh**

![DHCP](./images/DHCP_24.png)

- **`TTL/hop limit thấp` - Nền đỏ, chữ trắng**

![DHCP](./images/DHCP_25.png)

- **`ARP` - Nền màu da nhạt, chữ đen**

![DHCP](./images/DHCP_26.png)

- **`Routing` - Nền màu da đậm, chữ đen**

![DHCP](./images/DHCP_27.png)

- **`ICMP` - Nền hồng nhạt, chữ đen**

![DHCP](./images/DHCP_28.png)

- **`HTTP` - Nền xanh lá nhạt, chữ đen**

![DHCP](./images/DHCP_29.png)

- **`TCP` - Nền tím nhạt, chữ đen**

![DHCP](./images/DHCP_30.png)

- **`UDP` - Nền xanh dương nhạt, chữ đen**

![DHCP](./images/DHCP_31.png)

- **`Broadcast` - Không màu**

![DHCP](./images/DHCP_32.png)

- **`TCP SYN`/`FIN` - Nền xám, chữ đen**

![DHCP](./images/DHCP_33.png)

### 4. Mẹo sử dụng Filter (Ctrl+ F) để lọc gói tin

#### Chỉ bắt các gói tin có IP trùng khớp

- Bắt gói tin có Source IP là `192.168.3.86`

![DHCP](./images/DHCP_34.png)

- Bắt gói tin có Dest Ip là `192.168.3.235`

![DHCP](./images/DHCP_35.png)

- Bắt các gói tin có cả Source IP là `192.168.3.235` và Dest ip là `123.30.212.224`

![DHCP](./images/DHCP_36.png)

#### Chỉ bắt các gói tin có IP khác với 1 IP nào đó

- Bắt các gói tin có source ip khác ip `192.168.3.235`

![DHCP](./images/DHCP_37.png)

#### Chỉ bắt các gói có port hoặc giao thức trùng khớp

- Bắt các gói tin có TCP Port = `80`

![DHCP](./images/DHCP_38.png)

- Bắt các gói tin dùng `SSH`

![DHCP](./images/DHCP_39.png)

- Bắt các gói tin có `tcp.srcport == 80`

![DHCP](./images/DHCP_40.png)

- Bắt các gói tin có `tcp.dstport == 80`

![DHCP](./images/DHCP_41.png)
