# ASSIGN IP BY MAC - CẤP PHÁT IP THEO ĐỊA CHỈ MAC

## CentOS và Windows

### Bước 1. Xác định MAC của client

Chạy lệnh sau để lấy địa chỉ MAC:

**CentOS:**

```bash
ip link show ens33
hoặc
ip a
```

Kết quả: `link/ether`

![DHCP](./Lab_images/DHCP_82.png)

**Windows:**

- Windows + R -> `cmd`

```cmd
ipconfig /all
```

Tìm đến adapter mạng đang dùng (thường là Ethernet hoặc Wi-Fi) và ghi lại dòng:

![DHCP](./Lab_images/DHCP_83.png)

- Chuyển dấu `-` thành `:` và có thể viết thường.
- `b4:45:06:33:a9:c5`

### Bước 2. Chỉnh sửa file cấu hình DHCP server

Mở file cấu hình:

```bash
sudo nano /etc/dhcp/dhcpd.conf
```

Tìm đến phần khai báo subnet, thêm một đoạn cấu hình dạng sau vào bên trong hoặc ngay sau subnet:

```bash
# Cho centos
host centos-client {
  hardware ethernet 00:0c:29:66:dd:ec;
  fixed-address 192.168.60.54;
}

# Cho windows
host windows-client {
  hardware ethernet b4:45:06:33:a9:c5;
  fixed-address 192.168.60.80;
}
```

- `host centos-client`: tên định danh tuỳ chọn
- `hardware ethernet`: địa chỉ MAC của client
- `fixed-address`: IP muốn gán cố định

Ví dụ cấu hình đầy đủ subnet:

![DHCP](./Lab_images/DHCP_84.png)

### Bước 3. Khởi động lại DHCP server

```bash
sudo systemctl restart isc-dhcp-server
```

### Bước 4: Xin cấp phát lại IP trên máy client

**CentOS:**

```bash
# Giải phóng IP cũ
sudo dhclient -r ens33

# Yêu cầu cấp phát IP mới
sudo dhclient -v ens33
```

-> Kết quả:

![DHCP](./Lab_images/DHCP_85.png)

**Windows:**

```bash
# Giải phóng IP cũ
ipconfig /release

# Yêu cầu cấp phát IP mới
ipconfig /renew
```

### Bước 5: Kiểm tra DHCP leases

```plaintext
cat /var/lib/dhcp/dhcpd.leases
```
