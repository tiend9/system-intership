# CẤU HÌNH WEBSITE WordPress LEMP STACK

Apache và Nginx đều mặc định dùng cổng 80 (HTTP) và 443 (HTTPS). Như ở phần tạo website với LAMP stack đã sử dụng cổng `80` nên với website dùng LEMP stack sẽ sử dụng cổng `8080`.

## **`Bước 1`: Đổi cổng của nginx**

Mở file cấu hình nginx:

```plaintext
sudo vim /etc/nginx/sites-available/default
```

Thay đổi cổng nginx port `80`->`8080`:

![change nginx port](./images/change_nginx_port.png)

Khởi động lại nginx sau khi thay đổi cổng:

```plaintext
sudo systemctl restart nginx
```

## **`Bước 2`: Thay đổi thư mục web**

**Quan trọng:** Không dùng chung thư mục web giữa Apache và Nginx.

| Stack | Root Directory |
|-----------|-------------|
| LAMP | /var/www/html |
| LEMP | /var/www/lempsite |

Tạo thư mục cho website thứ 2:

```plaintext
sudo mkdir /var/www/lempsite

cd /var/www/lempsite

sudo wget https://wordpress.org/latest.tar.gz

sudo tar -xzvf latest.tar.gz --strip-components=1

sudo chown -R www-data:www-data /var/www/lempsite
```

- `--strip-components=1`: thay vì giải nén ra thư mục wordpress chứa các tệp tin wordpress bên trong thì sẽ giải nén trực tiếp các tệp tin ra ngoài mà không cần thư mục wordpress.

## **`Bước 3`: Tạo database và user cho wordpress**

```plaintext
sudo mysql -r root -p
```

Thêm mã sql:

```sql
CREATE DATABASE wordpress_lemp_db DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'wpuser_lemp'@'localhost' IDENTIFIED BY 'DoanTan28!';
GRANT ALL PRIVILEGES ON wordpress_lemp_db.* TO 'wpuser_lemp'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

## **`Bước 4`: Tạo file cấu hình nginx cho site mới**

```plaintext
sudo vim /etc/nginx/sites-available/lempsite
```

Nội dung file `lempsite`:

```plaintext
server {
    listen 8080;
    server_name localhost;

    root /var/www/lempsite;
    index index.php index.html;

    location / {
        try_files $uri $uri/ /index.php?$args;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/run/php/php8.3-fpm.sock;
    }

    location ~ /\.ht {
        deny all;
    }
}
```

Hình ảnh minh họa:

![change nginx port](./images/config_lempsite.png)

Kích hoạt site và restart nginx:

```plaintext
# Tạo một liên kết tượng trưng -> kích hoạt cấu hình website
sudo ln -s /etc/nginx/sites-available/lempsite /etc/nginx/sites-enabled/

sudo nginx -t

sudo systemctl reload nginx
```

- `ln`: Đây là lệnh dùng để tạo liên kết giữa các tệp tin. Có hai loại liên kết: liên kết cứng (hard link) và liên kết tượng trưng (symbolic link). Tùy chọn `-s` chỉ định rằng muốn tạo một liên kết tượng trưng.

## **`Bước 5`: Truy cập trình duyệt để cài WordPress**

Từ máy Windows, mở trình duyệt và nhập:

```plaintext
http://IP-của-ubuntu:8080
```

